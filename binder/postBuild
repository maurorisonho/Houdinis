#!/bin/bash
# Binder post-build script for Houdinis Framework
# This script runs after the environment is created

set -e

echo "ðŸ”§ Setting up Houdinis environment..."

# Install Houdinis in editable mode (if not already done via environment.yml)
pip install -e . --no-deps || true

# Pre-cache quantum backends (speeds up first notebook run)
echo "ðŸ“¦ Pre-caching quantum backends..."
python -c "
try:
    from qiskit import Aer
    backends = Aer.backends()
    print(f'âœ… Cached {len(backends)} Qiskit backends')
except Exception as e:
    print(f'âš ï¸  Backend caching failed: {e}')
" || true

# Enable JupyterLab extensions
echo "ðŸŽ¨ Enabling JupyterLab extensions..."
jupyter labextension enable @jupyter-widgets/jupyterlab-manager || true

# Create a welcome message
echo "ðŸ“ Creating welcome message..."
cat > /tmp/binder_welcome.txt << 'EOF'
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                          â•‘
â•‘         ðŸŽ‰ Welcome to Houdinis Framework! ðŸŽ‰            â•‘
â•‘                                                          â•‘
â•‘   Quantum Cryptography Testing Platform                 â•‘
â•‘   Running in MyBinder.org - Zero Installation!          â•‘
â•‘                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸš€ Quick Start:
   1. Open 'playground.ipynb' for a 5-minute tutorial
   2. Or explore the 'notebooks/' directory
   3. Run cells with Shift+Enter

ðŸ“š Documentation: https://maurorisonho.github.io/Houdinis/
ðŸ™ GitHub: https://github.com/maurorisonho/Houdinis

âš ï¸  Note: This is a cloud environment with resource limits:
   - 2GB RAM, 1-2 CPU cores
   - Best for learning and small experiments
   - For production use, install locally

Happy hacking! ðŸ”
EOF

# Display welcome message
cat /tmp/binder_welcome.txt

# Configure Jupyter to show the welcome message on startup
mkdir -p ~/.jupyter/custom
cat > ~/.jupyter/custom/custom.js << 'EOF'
// Show welcome message in console
console.log('%cðŸŽ‰ Houdinis Framework loaded successfully!', 'color: #00ff00; font-size: 16px; font-weight: bold;');
EOF

echo ""
echo "âœ… Houdinis Binder environment setup complete!"
echo "ðŸŽ® Ready to run quantum cryptography attacks in your browser!"
echo ""
